<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Austin Ginder's Music</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // Deep Sea Palette
                        primary: '#22d3ee',   // Cyan-400 (Bioluminescence)
                        secondary: '#0ea5e9', // Sky-500
                        dark: '#020617',      // Slate-950 (The Abyss)
                        surface: '#0f172a',   // Slate-900 (Deep Water)
                        accent: '#14b8a6',    // Teal-500
                        
                        // Light mode equivalents (Coastal/Sand)
                        'light-bg': '#f0f9ff', // Sky-50
                        'light-surface': '#ffffff',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    backgroundImage: {
                        'ocean-gradient': 'linear-gradient(to bottom right, #0f172a, #020617)',
                        'light-gradient': 'linear-gradient(to bottom right, #f0f9ff, #e0f2fe)',
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 12px; width: 12px;
            border-radius: 50%; background: currentColor; margin-top: -4px; cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: currentColor; opacity: 0.3; border-radius: 2px;
        }
        [v-cloak] { display: none; }
        
        /* Glass morphism utilities */
        .glass {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        /* Animated Equalizer */
        .playing-bars { display: flex; align-items: flex-end; height: 12px; gap: 2px; }
        .bar { width: 3px; background-color: currentColor; animation: bounce 1s infinite ease-in-out; }
        .bar:nth-child(1) { animation-duration: 0.6s; height: 40%; }
        .bar:nth-child(2) { animation-duration: 0.9s; height: 100%; }
        .bar:nth-child(3) { animation-duration: 0.7s; height: 70%; }
        @keyframes bounce {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1); }
        }
    </style>
</head>
<body class="bg-light-bg dark:bg-dark text-slate-700 dark:text-slate-200 transition-colors duration-300 font-sans antialiased pb-32 min-h-screen bg-light-gradient dark:bg-ocean-gradient">

<div id="app" v-cloak>
    <header class="relative md:sticky top-0 z-40 w-full glass bg-white/70 dark:bg-surface/70 border-b border-sky-100 dark:border-white/5 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row items-center justify-between h-auto md:h-20 py-3 md:py-0 gap-4">
                
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-primary to-secondary text-white flex items-center justify-center font-bold shadow-lg shadow-primary/20">
                        <i class="ph-fill ph-waves text-xl"></i>
                    </div>
                    <span class="font-bold text-lg tracking-tight text-slate-800 dark:text-white">Austin Ginder's Music</span>
                </div>

                <div class="flex-grow max-w-md w-full relative group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="ph ph-magnifying-glass text-gray-400 group-focus-within:text-primary transition-colors"></i>
                    </div>
                    <input 
                        v-model="searchQuery" 
                        type="text" 
                        placeholder="Search songs or albums..." 
                        class="block w-full pl-10 pr-3 py-2 border border-gray-200 dark:border-white/10 rounded-full leading-5 bg-gray-50/50 dark:bg-black/20 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary/50 sm:text-sm transition-all"
                    >
                    <button v-if="searchQuery" @click="searchQuery = ''" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white">
                        <i class="ph-fill ph-x-circle"></i>
                    </button>
                </div>

                <div class="flex items-center gap-2">
                    
                    <a href="https://austinginder.com" target="_blank" class="relative group p-2 rounded-full hover:bg-sky-100 dark:hover:bg-white/10 transition text-slate-600 dark:text-slate-300">
                        <i class="ph ph-house text-xl"></i>
                        <span class="absolute top-full mt-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-slate-800 dark:bg-black text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-lg">
                            austinginder.com
                        </span>
                    </a>

                    <a href="https://open.spotify.com/artist/5L5nJdTTF0y6kjNagDLCpA" target="_blank" class="relative group p-2 rounded-full hover:bg-sky-100 dark:hover:bg-white/10 transition text-slate-600 dark:text-slate-300">
                        <i class="ph ph-spotify-logo text-xl"></i>
                        <span class="absolute top-full mt-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-slate-800 dark:bg-black text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-lg">
                            Spotify
                        </span>
                    </a>

                    <a href="https://github.com/austinginder/music/" target="_blank" class="relative group p-2 rounded-full hover:bg-sky-100 dark:hover:bg-white/10 transition text-slate-600 dark:text-slate-300">
                        <i class="ph ph-github-logo text-xl"></i>
                        <span class="absolute top-full mt-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-slate-800 dark:bg-black text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-lg">
                            GitHub Source
                        </span>
                    </a>

                    <button @click="toggleDarkMode" class="relative group p-2 rounded-full hover:bg-sky-100 dark:hover:bg-white/10 transition text-primary">
                        <i :class="isDarkMode ? 'ph-sun' : 'ph-moon-stars'" class="ph-fill text-xl"></i>
                        <span class="absolute top-full mt-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-slate-800 dark:bg-black text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-lg">
                            {{ isDarkMode ? 'Light Mode' : 'Dark Mode' }}
                        </span>
                    </button>

                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div v-if="!searchQuery" class="grid grid-cols-3 gap-4 mb-12 text-center max-w-lg mx-auto bg-white/50 dark:bg-surface/50 glass rounded-2xl shadow-sm border border-sky-100 dark:border-white/5 p-4">
            <div>
                <div class="text-2xl font-bold text-primary drop-shadow-sm">{{ tracks.length }}</div>
                <div class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider font-semibold">Tracks</div>
            </div>
            <div class="border-l border-r border-sky-200 dark:border-white/10">
                <div class="text-2xl font-bold text-primary drop-shadow-sm">{{ albums.length }}</div>
                <div class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider font-semibold">Albums</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-primary drop-shadow-sm">{{ totalTime }}</div>
                <div class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider font-semibold">Duration</div>
            </div>
        </div>

        <div v-if="searchQuery && filteredSingleTracks.length === 0 && filteredAlbums.length === 0" class="text-center py-20 opacity-60">
            <i class="ph ph-fish-simple text-6xl mb-4 text-primary animate-bounce"></i>
            <h3 class="text-xl font-medium">No treasures found in the deep.</h3>
            <p>Try a different search term.</p>
        </div>

        <section v-show="filteredSingleTracks.length > 0" class="mb-16">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2 text-slate-800 dark:text-white">
                <i class="ph-fill ph-music-notes-simple text-primary"></i> 
                {{ searchQuery ? 'Matching Singles' : 'Singles' }}
            </h2>
            <div class="bg-white dark:bg-surface/50 glass rounded-2xl shadow-lg border border-sky-100 dark:border-white/5 overflow-hidden">
                <div v-for="(item, index) in filteredSingleTracks" :key="item.title" 
                     @click="playTrack(item, index, null)"
                     class="group flex items-center p-4 hover:bg-sky-50 dark:hover:bg-white/5 cursor-pointer border-b last:border-0 border-sky-100 dark:border-white/5 transition">
                    
                    <div class="w-12 h-12 rounded-full bg-sky-100 dark:bg-black/20 flex items-center justify-center text-slate-400 group-hover:text-primary group-hover:scale-110 transition mr-4 ring-1 ring-inset ring-white/5">
                        <i class="ph-fill text-xl" :class="isCurrentTrack(item) && playing ? 'ph-pause' : 'ph-play'"></i>
                    </div>
                    
                    <div class="flex-grow">
                        <h3 class="font-medium text-lg" :class="isCurrentTrack(item) ? 'text-primary' : 'text-slate-700 dark:text-slate-200'">
                            {{ item.title }}
                        </h3>
                        <p class="text-sm text-slate-500 dark:text-slate-400">{{ item.date }}</p>
                    </div>
                    
                    <div class="text-sm text-slate-400 font-mono">{{ item.duration }}</div>
                </div>
            </div>
        </section>

        <section v-show="filteredAlbums.length > 0">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2 text-slate-800 dark:text-white">
                <i class="ph-fill ph-disc text-primary"></i> 
                {{ searchQuery ? 'Matching Albums' : 'Albums' }}
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <div v-for="(album, albumIndex) in filteredAlbums" :key="album.title" 
                     class="bg-white dark:bg-surface/40 glass rounded-2xl shadow-lg border border-sky-100 dark:border-white/5 overflow-hidden hover:shadow-cyan-500/10 hover:-translate-y-1 transition duration-300 flex flex-col">
                    
                    <div class="relative aspect-square bg-sky-200 dark:bg-slate-800 group cursor-pointer overflow-hidden" @click="playFirstTrackOfAlbum(album)">
                        <img v-if="album.artwork !== false" :src="`images/${album.title}.webp`" class="w-full h-full object-cover transition duration-700 group-hover:scale-110" loading="lazy">
                        <div v-else class="w-full h-full flex items-center justify-center text-slate-400/50">
                            <i class="ph ph-waves text-6xl"></i>
                        </div>
                        <div class="absolute inset-0 bg-slate-900/40 opacity-0 md:group-hover:opacity-100 transition flex items-center justify-center backdrop-blur-sm pointer-events-none md:pointer-events-auto">
                            <button class="w-16 h-16 rounded-full bg-primary text-dark flex items-center justify-center shadow-lg shadow-primary/50 transform scale-90 md:group-hover:scale-100 transition">
                                <i class="ph-fill ph-play text-3xl ml-1"></i>
                            </button>
                        </div>
                    </div>

                    <div class="p-5 flex-grow flex flex-col">
                        <h3 class="font-bold text-lg mb-1 text-slate-800 dark:text-white truncate">{{ album.title }}</h3>
                        <div class="flex flex-col gap-1 mb-4">
                            <div class="text-xs font-bold text-secondary dark:text-primary uppercase tracking-wider">
                                {{ album.date }}
                            </div>
                            
                            <div class="flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
                                <span class="flex items-center gap-1">
                                    <i class="ph-fill ph-music-notes-simple"></i>
                                    {{ albumTracks(album).length }} Tracks
                                </span>
                                <span class="flex items-center gap-1">
                                    <i class="ph-fill ph-clock"></i>
                                    {{ totalAlbumDuration(album) }}
                                </span>
                            </div>
                        </div>

                        <div class="space-y-1 md:overflow-y-auto md:max-h-60 md:pr-1 custom-scrollbar">
                            <div v-for="(track, tIndex) in albumTracks(album)" :key="track.title"
                                 v-show="!searchQuery || track.title.toLowerCase().includes(searchQuery.toLowerCase()) || album.title.toLowerCase().includes(searchQuery.toLowerCase())"
                                 @click="playTrack(track, null, album)"
                                 class="flex items-center py-2 px-2 rounded-lg cursor-pointer hover:bg-sky-50 dark:hover:bg-white/5 text-sm transition group"
                                 :class="{'bg-sky-50 dark:bg-white/10': isCurrentTrack(track)}">
                                
                                <span class="w-6 text-xs text-slate-400 font-mono text-center mr-2 flex justify-center items-center h-4">
                                    <i class="ph-fill ph-play text-slate-600 dark:text-slate-300 hidden group-hover:inline-block" v-if="!isCurrentTrack(track)"></i>
                                    <span class="group-hover:hidden" v-if="!isCurrentTrack(track)">{{ track.position }}</span>
                                    <div v-else-if="isCurrentTrack(track) && playing" class="playing-bars text-primary">
                                        <div class="bar"></div><div class="bar"></div><div class="bar"></div>
                                    </div>
                                    <i class="ph-fill ph-speaker-high text-primary" v-else></i>
                                </span>
                                
                                <span class="flex-grow truncate" :class="isCurrentTrack(track) ? 'text-primary font-bold' : 'text-slate-600 dark:text-slate-300'">
                                    <span v-if="searchQuery && track.title.toLowerCase().includes(searchQuery.toLowerCase())" class="text-secondary dark:text-primary decoration-wavy underline decoration-primary/50">{{ track.title }}</span>
                                    <span v-else>{{ track.title }}</span>
                                </span>
                                <span class="text-xs text-slate-400 ml-2">{{ track.duration }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="fixed bottom-0 left-0 right-0 z-50">
        <div class="max-w-4xl mx-auto bg-white/95 dark:bg-surface/90 glass border-t md:border border-sky-200 dark:border-white/10 p-3 md:p-4 transition-all duration-300 transform md:mb-4 md:rounded-2xl md:shadow-2xl"
             :class="{'translate-y-[150%]': !loaded && !selected_item.title}">
            
            <div class="absolute -top-3 left-0 right-0 group cursor-pointer h-6 z-20" 
                 @click="seekTo($event)" ref="progressBar">
                <div class="absolute top-3 w-full h-1 bg-gray-200 dark:bg-gray-700 md:rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-secondary to-primary transition-all duration-100 ease-linear" :style="{ width: percentage + '%' }"></div>
                </div>
                <div class="absolute top-3 w-3 h-3 bg-primary ring-2 ring-white dark:ring-dark rounded-full shadow opacity-0 group-hover:opacity-100 transition-opacity -mt-[4px] pointer-events-none"
                     :style="{ left: percentage + '%' }"></div>
            </div>
    
            <div class="flex flex-row items-center justify-between gap-3 mt-1">
                
                <div class="flex items-center flex-1 md:flex-none md:w-1/3 gap-3 overflow-hidden min-w-0">
                    <div class="w-10 h-10 md:w-12 md:h-12 bg-sky-100 dark:bg-black/20 rounded-lg flex-shrink-0 flex items-center justify-center text-primary border border-white/5">
                        <i class="ph-fill ph-music-note text-lg md:text-xl"></i>
                    </div>
                    <div class="min-w-0 flex-1">
                        <div class="font-bold truncate text-sm sm:text-base text-slate-800 dark:text-white">{{ selected_item.title || 'Select a track' }}</div>
                        <div class="text-xs text-slate-500 dark:text-slate-400 truncate font-mono">
                            {{ currentTimeFormatted }} / {{ durationFormatted }}
                        </div>
                    </div>
                </div>
    
                <div class="flex items-center justify-center gap-3 md:gap-4 flex-none md:w-1/3">
                    <button @click="playPrevious" :disabled="!loaded" class="text-slate-400 hover:text-primary disabled:opacity-30 transition p-2">
                        <i class="ph-fill ph-skip-back text-xl md:text-2xl"></i>
                    </button>
                    
                    <button @click="togglePlay" :disabled="!loaded" 
                            class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-gradient-to-tr from-primary to-secondary text-dark flex items-center justify-center shadow-lg shadow-primary/30 hover:scale-105 active:scale-95 transition disabled:opacity-50 disabled:scale-100">
                        <i class="ph-fill text-lg md:text-2xl" :class="playing ? 'ph-pause' : 'ph-play'"></i>
                    </button>
                    
                    <button @click="playNext()" :disabled="!loaded" class="text-slate-400 hover:text-primary disabled:opacity-30 transition p-2">
                        <i class="ph-fill ph-skip-forward text-xl md:text-2xl"></i>
                    </button>
                </div>
    
                <div class="hidden md:flex items-center justify-end gap-3 md:w-1/3">
                    <button @click="toggleAutoplay" class="transition" :class="autoplay ? 'text-primary' : 'text-slate-400'">
                        <i class="ph ph-repeat text-xl"></i>
                    </button>
                    
                    <div class="flex items-center gap-2 group relative w-24">
                        <button @click="toggleMute" class="text-slate-400 hover:text-primary transition">
                                <i class="ph-fill text-xl" :class="isMuted || playerVolume == 0 ? 'ph-speaker-x' : 'ph-speaker-high'"></i>
                        </button>
                        <input type="range" min="0" max="1" step="0.01" v-model="playerVolume" 
                               class="w-full h-1 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer text-primary">
                    </div>
    
                    <a v-if="loaded" :href="`${share_url}/${selected_item.audio}.mp3`" target="_blank" class="text-slate-400 hover:text-primary transition">
                        <i class="ph ph-download-simple text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                local_share_url: "",
                share_url: "",
                tracks: [],
                albums: [],
                searchQuery: "", 
                
                selected_item: {},
                selected_item_index: null, 
                current_album: null,       
                
                duration: 0,
                isMuted: false,
                paused: false,
                playing: false,
                autoplay: true,
                playerVolume: 1,
                percentage: 0,
                sound: null,
                loaded: false,
                isDarkMode: true 
            }
        },
        computed: {
            // Raw Singles
            singleTracks() {
                return this.tracks.filter(t => !t.album || t.album === "")
            },
            // Filtered Singles based on Search
            filteredSingleTracks() {
                if (!this.searchQuery) return this.singleTracks;
                const lowerQuery = this.searchQuery.toLowerCase();
                return this.singleTracks.filter(t => t.title.toLowerCase().includes(lowerQuery));
            },
            // Filtered Albums based on Title OR Track contents
            filteredAlbums() {
                if (!this.searchQuery) return this.albums;
                const lowerQuery = this.searchQuery.toLowerCase();
                
                return this.albums.filter(album => {
                    // Match Album Title
                    if (album.title.toLowerCase().includes(lowerQuery)) return true;
                    
                    // OR Match any track inside the album
                    const albumTracks = this.albumTracks(album);
                    return albumTracks.some(t => t.title.toLowerCase().includes(lowerQuery));
                });
            },
            totalTime() {
                let seconds = 0;
                this.tracks.forEach(item => {
                    seconds += this.parseDuration(item.duration);
                });
                return this.formatTime(seconds);
            },
            currentTimeFormatted() {
                return this.formatTime(this.duration * (this.percentage / 100));
            },
            durationFormatted() {
                return this.formatTime(this.duration);
            }
        },
        watch: {
            playerVolume(val) {
                if(this.sound) this.sound.volume(val);
            },
            isDarkMode(val) {
                if(val) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
                localStorage.setItem('darkMode', val);
            },
            // Dynamic Browser Title Logic
            selected_item(newItem) {
                if (newItem && newItem.title) {
                    document.title = `▶ ${newItem.title} - Austin Ginder`;
                } else {
                    document.title = "Austin Ginder's Music";
                }
            },
            playing(isPlaying) {
                if (!this.selected_item.title) return;
                const prefix = isPlaying ? '▶ ' : '❚❚ ';
                document.title = `${prefix}${this.selected_item.title} - Austin Ginder`;
            }
        },
        async mounted() {
            // Theme Init
            const savedTheme = localStorage.getItem('darkMode');
            this.isDarkMode = savedTheme === null ? true : savedTheme === 'true';
            
            if(this.isDarkMode) document.documentElement.classList.add('dark');

            // Data Fetch
            try {
                const response = await fetch('data.json');
                const data = await response.json();
                this.tracks = data.tracks;
                this.albums = data.albums.map(a => ({...a, position: null}));
                this.local_share_url = data.local_share_url;
                this.share_url = data.share_url;

                if (window.location.host.endsWith(".localhost")) {
                    this.share_url = this.local_share_url;
                }
            } catch (error) {
                console.error("Could not load music data:", error);
            }

            // Keyboard Shortcuts
            window.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT') return; 
                
                if (e.code === 'Space') {
                    e.preventDefault();
                    this.togglePlay();
                } else if (e.code === 'ArrowRight') {
                    this.playNext();
                } else if (e.code === 'ArrowLeft') {
                    this.playPrevious();
                }
            });
        },
        methods: {
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
            },
            toggleAutoplay() {
                this.autoplay = !this.autoplay;
            },
            pad(num) {
                return num.toString().padStart(2, '0');
            },
            parseDuration(timeStr) {
                if(!timeStr) return 0;
                const parts = timeStr.split(':').map(Number);
                if (parts.length === 3) return parts[0] * 3600 + parts[1] * 60 + parts[2];
                if (parts.length === 2) return parts[0] * 60 + parts[1];
                return 0;
            },
            formatTime(secondsInput) {
                if (!secondsInput || isNaN(secondsInput)) return '00:00';
                let sec_num = parseInt(secondsInput, 10);
                let hours = Math.floor(sec_num / 3600);
                let minutes = Math.floor((sec_num - (hours * 3600)) / 60);
                let seconds = sec_num - (hours * 3600) - (minutes * 60);

                if (hours > 0) return `${hours}:${this.pad(minutes)}:${this.pad(seconds)}`;
                return `${this.pad(minutes)}:${this.pad(seconds)}`;
            },
            albumTracks(album) {
                return this.tracks
                    .filter(t => t.album == album.title)
                    .sort((a, b) => (a.position || 0) - (b.position || 0));
            },
            isCurrentTrack(item) {
                return this.selected_item && this.selected_item.title === item.title;
            },
            totalAlbumDuration(album) {
                let seconds = 0;
                this.albumTracks(album).forEach(track => {
                    seconds += this.parseDuration(track.duration);
                });
                return this.formatTime(seconds);
            },
            togglePlay() {
                if (!this.sound) return;
                if (this.playing) {
                    this.sound.pause();
                } else {
                    this.sound.play();
                }
            },
            toggleMute() {
                this.isMuted = !this.isMuted;
                if(this.sound) this.sound.mute(this.isMuted);
            },
            seekTo(event) {
                if (!this.loaded || !this.duration) return;
                const rect = this.$refs.progressBar.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const clickedPercentage = x / rect.width;
                this.sound.seek(this.duration * clickedPercentage);
                this.percentage = clickedPercentage * 100;
            },
            
            playTrack(item, index, album) {
                this.selected_item = item;
                
                if (album) {
                    this.current_album = album;
                    this.selected_item_index = null;
                } else {
                    this.current_album = null;
                    this.selected_item_index = index; 
                }

                this.initHowler();
            },
            playFirstTrackOfAlbum(album) {
                const tracks = this.albumTracks(album);
                if (tracks.length > 0) {
                    this.playTrack(tracks[0], null, album);
                }
            },
            initHowler() {
                if (this.sound) {
                    this.sound.unload();
                }

                this.loaded = false;
                this.percentage = 0;
                
                this.sound = new Howl({
                    src: [
                        `${this.share_url}/${this.selected_item.audio}.webm`,
                        `${this.share_url}/${this.selected_item.audio}.mp3`,
                    ],
                    html5: true,
                    volume: this.playerVolume,
                    onplay: () => {
                        this.playing = true;
                        this.paused = false;
                        this.duration = this.sound.duration();
                        requestAnimationFrame(this.step);
                    },
                    onpause: () => {
                        this.playing = false;
                        this.paused = true;
                    },
                    onstop: () => {
                        this.playing = false;
                        this.paused = false;
                        this.percentage = 0;
                    },
                    onend: () => {
                        this.playing = false;
                        this.percentage = 100;
                        if (this.autoplay) this.playNext(true);
                    },
                    onload: () => {
                        this.loaded = true;
                        this.duration = this.sound.duration();
                    }
                });
                
                this.sound.play();
            },
            step() {
                if (this.sound && this.sound.playing()) {
                    const seek = this.sound.seek() || 0;
                    this.percentage = (seek / this.duration) * 100 || 0;
                    requestAnimationFrame(this.step);
                }
            },
            playNext(fromAuto = false) {
                if (!fromAuto && !this.autoplay && fromAuto) return;

                // Scenario 1: Playing a Single Track
                if (this.selected_item_index !== null) {
                    if (this.selected_item_index < this.singleTracks.length - 1) {
                        this.playTrack(this.singleTracks[this.selected_item_index + 1], this.selected_item_index + 1, null);
                    } else if (this.albums.length > 0) {
                        this.playFirstTrackOfAlbum(this.albums[0]);
                    }
                    return;
                }

                // Scenario 2: Playing from an Album
                if (this.current_album) {
                    const tracks = this.albumTracks(this.current_album);
                    const currentIdx = tracks.findIndex(t => t.title === this.selected_item.title);
                    
                    if (currentIdx < tracks.length - 1) {
                        this.playTrack(tracks[currentIdx + 1], null, this.current_album);
                    } else {
                        const albumIdx = this.albums.findIndex(a => a.title === this.current_album.title);
                        if (albumIdx < this.albums.length - 1) {
                            this.playFirstTrackOfAlbum(this.albums[albumIdx + 1]);
                        } else if (this.singleTracks.length > 0 && this.autoplay) {
                             this.playTrack(this.singleTracks[0], 0, null);
                        }
                    }
                }
            },
            playPrevious() {
                // Scenario 1: Playing a Single
                if (this.selected_item_index !== null) {
                    if (this.selected_item_index > 0) {
                        this.playTrack(this.singleTracks[this.selected_item_index - 1], this.selected_item_index - 1, null);
                    } else if (this.albums.length > 0) {
                         const lastAlbum = this.albums[this.albums.length - 1];
                         const tracks = this.albumTracks(lastAlbum);
                         if (tracks.length) this.playTrack(tracks[tracks.length-1], null, lastAlbum);
                    }
                    return;
                }

                // Scenario 2: Playing from Album
                if (this.current_album) {
                    const tracks = this.albumTracks(this.current_album);
                    const currentIdx = tracks.findIndex(t => t.title === this.selected_item.title);

                    if (currentIdx > 0) {
                        this.playTrack(tracks[currentIdx - 1], null, this.current_album);
                    } else {
                        const albumIdx = this.albums.findIndex(a => a.title === this.current_album.title);
                        if (albumIdx > 0) {
                            const prevAlbum = this.albums[albumIdx - 1];
                            const prevTracks = this.albumTracks(prevAlbum);
                            if(prevTracks.length) this.playTrack(prevTracks[prevTracks.length-1], null, prevAlbum);
                        } else if (this.singleTracks.length > 0) {
                            this.playTrack(this.singleTracks[this.singleTracks.length - 1], this.singleTracks.length - 1, null);
                        }
                    }
                }
            }
        }
    }).mount('#app');
</script>
</body>
</html>