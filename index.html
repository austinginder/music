<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Austin Ginder's Music</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <style>
      [v-cloak] > * {
        display:none;
      }
    </style>
</head>
<body>
  <div id="app" v-cloak>
    <v-app>
      <v-main>
        <v-toolbar dark color="primary">
            <v-toolbar-title>Austin Ginder's Music</v-toolbar-title>
            <v-spacer></v-spacer>
            <v-tooltip bottom>
              <template v-slot:activator="{ on, attrs }">
                <v-btn href="https://austinginder.com" icon target="_blank" v-bind="attrs" v-on="on"><v-icon>mdi-home</v-icon></v-btn>
              </template>
              <span><v-icon small>mdi-open-in-new</v-icon> austinginder.com</span>
            </v-tooltip>
            <v-tooltip bottom>
              <template v-slot:activator="{ on, attrs }">
                <v-btn href="https://soundcloud.com/austinginder/" icon target="_blank" v-bind="attrs" v-on="on"><v-icon>mdi-soundcloud</v-icon></v-btn>
              </template>
              <span><v-icon small>mdi-open-in-new</v-icon> soundcloud.com/austinginder</span>
            </v-tooltip>
            <v-tooltip bottom>
              <template v-slot:activator="{ on, attrs }">
                <v-btn href="https://github.com/austinginder/music/" icon target="_blank" v-bind="attrs" v-on="on"><v-icon>mdi-github</v-icon></v-btn>
              </template>
              <span><v-icon small>mdi-open-in-new</v-icon> github.com/austinginder/music</span>
            </v-tooltip>
        </v-toolbar>
        <v-card flat class="text-center mt-4">
            <v-icon size="20" class="mb-1">mdi-folder-music-outline</v-icon> {{ tracks.length }} tracks <v-icon size="20" class="ml-4 mb-1">mdi-album</v-icon> {{ albums.length }} albums <v-icon size="20" class="ml-4 mb-1">mdi-clock-outline</v-icon> {{ totalTime }} duration 
        </v-card>
        <v-container>
            <v-row>
              <v-col cols="12">
                <v-list class="elevation-2" max-width="800px" style="margin:auto;">
                  <v-list-item-group v-model="selected_item_index" color="primary">
                    <v-list-item
                      v-for="item in singleTracks"
                      :key="item.title"
                      target="_blank"
                      :href=`audio/${item.audio}.webm`
                      @click.prevent="selected_item = item; playAudio()"
                    >
                      <v-list-item-avatar>
                          <v-icon large>mdi-play-box</v-icon>
                      </v-list-item-avatar>
                      <v-list-item-content>
                        <v-list-item-title>
                            {{ item.title }}
                        </v-list-item-title>
                      </v-list-item-content>
                      <v-list-item-action>
                        <v-list-item-action-text></v-list-item-action> <v-icon size="18" class="mb-1 mr-1">mdi-calendar-clock</v-icon> {{ item.date }} <v-icon size="18" class="mb-1 mr-1 ml-5">mdi-clock-outline</v-icon> {{ item.duration }}</v-list-item-action-text>
                      </v-list-item-action>
                    </v-list-item>
                    </v-list-item-group>
                </v-list>
              </v-col>
            </v-row>
            <v-row v-for="album in albums">
              <v-col cols="12">
                <v-card  max-width="400px" style="margin:auto;">
                <img :src=`images/${album.title}.jpg` style="max-width:100%;">
                  <v-list dense>
                    <v-list-item>
                      <v-list-item-content>
                      <v-list-item-title>Name</v-list-item-title>
                      <v-list-item-subtitle>{{ album.title }}</v-list-item-subtitle>
                    </v-list-item-content>
                    </v-list-item>
                    <v-list-item>
                      <v-list-item-content>
                      <v-list-item-title>Date</v-list-item-title>
                      <v-list-item-subtitle>{{ album.date }}</v-list-item-subtitle>
                    </v-list-item-content>
                    </v-list-item>
                    <v-list-item>
                      <v-list-item-content>
                      <v-list-item-title>{{ albumTracks( album ).length }} tracks</v-list-item-title>
                    </v-list-item-content>
                    </v-list-item>
                    <v-list-item>
                      <v-list-item-content>
                      <v-list-item-title>{{ trackLength( albumTracks( album ) ) }} duration</v-list-item-title>
                    </v-list-item-content>
                    </v-list-item>
                  </v-list>
                  <v-list>
                    <v-list-item-group v-model="album.position" color="primary">
                      <v-list-item
                        v-for="item in albumTracks( album )"
                        :key="item.title"
                        target="_blank"
                        :href=`audio/${item.audio}.webm`
                        @click.prevent="selected_item = item; playAudio()"
                      >
                        <v-list-item-avatar>
                            <v-icon large>mdi-play-box</v-icon>
                        </v-list-item-avatar>
                        <v-list-item-content>
                          <v-list-item-title>
                            {{ item.position }}. {{ item.title }} <span class="text-right"></span>
                          </v-list-item-title>
                        </v-list-item-content>
                        <v-list-item-action>
                          <v-list-item-action-text></v-list-item-action><v-icon size="18" class="mb-1 mr-1">mdi-clock-outline</v-icon> {{ item.duration }}</v-list-item-action-text>
                        </v-list-item-action>
                      </v-list-item>
                      </v-list-item-group>
                  </v-list>
                </v-col>
                </v-row>
              </v-card>
              </v-col>
            </v-row>
        </v-container>
      </v-main>
      <v-footer fixed padless app>
        <v-card width="100%" color="grey lighten-4">
          <v-card-text style="max-width:400px;margin:auto" class="text-center pa-2">
              <v-btn icon class="ma-2" @click.native="sound.playing() ? sound.pause() : sound.play()" :disabled="!loaded">
                  <v-icon large v-if="!playing || paused">mdi-play-circle</v-icon>
                  <v-icon large v-else>mdi-pause-circle</v-icon>
              </v-btn>
              <v-btn icon class="ma-2" @click.native="sound.stop()" :disabled="!loaded">
                  <v-icon large>mdi-stop-circle</v-icon>
              </v-btn>
              <v-btn icon class="ma-2" @click.native="sound.mute( true )" :disabled="!loaded" v-if="! isMuted">
                  <v-icon large>mdi-volume-high</v-icon>
              </v-btn>
              <v-btn icon class="ma-2" @click.native="sound.mute( false )" :disabled="!loaded" v-else>
                <v-icon large>mdi-volume-off</v-icon>
              </v-btn>
              <v-btn icon class="ma-2" v-if="loaded" :href=`audio/${selected_item.audio}.mp3` target="_blank">
                  <v-icon large>mdi-download-circle</v-icon>
              </v-btn>
              <v-tooltip bottom>
                <template v-slot:activator="{ on, attrs }">
                  <v-btn icon class="ma-2" v-show="autoplay" @click="autoplay = false" v-bind="attrs" v-on="on">
                    <v-icon large>mdi-repeat</v-icon>
                  </v-btn>
                </template>
                <span>Repeat</span>
              </v-tooltip>
              <v-tooltip bottom>
                <template v-slot:activator="{ on, attrs }">
                  <v-btn icon class="ma-2" v-show="! autoplay"  @click="autoplay = true" v-bind="attrs" v-on="on">
                    <v-icon large>mdi-repeat-off</v-icon>
                  </v-btn>
                </template>
                <span>Repeat</span>
              </v-tooltip>
              <v-slider v-model="playerVolume" prepend-icon="mdi-volume-high" max="1" step="0.01" min="0" v-show="!playerVolume"></v-slider>
              <v-progress-linear hide-details stream v-model="percentage" height="20" @change="sound.seek( duration * ( percentage / 100 ) )" :disabled="!loaded">
                <span v-show="selected_item.title" class="white--text caption">Austin Ginder - {{ selected_item.title }}</span>
              </v-progress-linear>
              <p>{{ currentTime | formatTime }} / {{ duration | formatTime }}</p>
          </v-card-text>
      </v-card>
      </v-footer>
    </v-app>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"></script>
  <script>
    new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data: {
          tracks: [
              { date: "Dec 21th, 2021", author: "Austin Ginder", title: "Panther on the Move", duration: "5:59", audio: "2021-12-21 Panther on the Move" },
              { date: "Dec 19th, 2021", author: "Austin Ginder", title: "Little Sea Turtle", duration: "4:20", audio: "2021-12-19 Little Sea Turtle" },
              { date: "Dec 16th, 2021", author: "Austin Ginder", title: "Manatees Hiding", duration: "4:41", audio: "2021-12-16 Manatees Hiding" },
              { date: "Dec 13th, 2021", author: "Austin Ginder", title: "Hello C35", duration: "4:00", audio: "2021-12-13 Hello C35", album: "Hello XYZ", position: 9 },
              { date: "Dec 10th, 2021", author: "Austin Ginder", title: "Hello E3PO", duration: "3:39", audio: "2021-12 Hello E3PO", album: "Hello XYZ", position: 8 },
              { date: "Dec 9th, 2021", author: "Austin Ginder", title: "Hello A37", duration: "4:15", audio: "2021-12-09 Hello A37", album: "Hello XYZ", position: 4 },
              { date: "Dec 7th, 2021", author: "Austin Ginder", title: "Hello i5", duration: "3:52", audio: "2021-12-07 Hello i5", album: "Hello XYZ", position: 6 },
              { date: "Dec 4th, 2021", author: "Austin Ginder", title: "Hello T100", duration: "2:27", audio: "2021-12-04 Hello T100", album: "Hello XYZ", position: 3 },
              { date: "Dec 2nd, 2021", author: "Austin Ginder", title: "Hello M2", duration: "3:46", audio: "2021-12-02 Hello M2", album: "Hello XYZ", position: 7 },
              { date: "Nov 27th, 2021", author: "Austin Ginder", title: "Hello L500", duration: "2:23", audio: "2021-11-27 Hello L500", album: "Hello XYZ", position: 2 },
              { date: "Nov 26th, 2021", author: "Austin Ginder", title: "Hello A1", duration: "2:37", audio: "2021-11-26 Hello A1", album: "Hello XYZ", position: 5 },
              { date: "Oct 21st, 2021", author: "Austin Ginder", title: "Hello World", duration: "3:06", audio: "2021-10-21 Hello World", album: "Hello XYZ", position: 1 },
          ],
          albums: [
              { date: "Future 2022", author: "Austin Ginder", title: "Hello XYZ" }
          ],
          selected_item: {},
          selected_item_index: null,
          selected_album_index: null,
          duration: 0,
          isMuted: false,
          paused: false,
          playing: false,
          autoplay: true,
          playerVolume: 1,
          percentage: 0,
          sound: {},
          loaded: false,
      },
      mounted() {
        this.albums.forEach( a => a.position = "" )
        window.addEventListener('keydown', (e) => {
          if (e.key == 32 || e.key == ' ') {
            this.sound.playing() ? this.sound.pause() : this.sound.play()
          }
        })
      },
      filters: {
        formatTime: function ( value ) {
          var sec_num = parseInt(value, 10); // don't forget the second param
          var hours   = Math.floor(sec_num / 3600);
          var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
          var seconds = sec_num - (hours * 3600) - (minutes * 60);

          if (hours   < 10) {hours   = "0"+hours;}
          if (minutes < 10) {minutes = "0"+minutes;}
          if (seconds < 10) {seconds = "0"+seconds;}
          return minutes + ':' + seconds;
        },
      },
      watch: {
        playerVolume() {
          Howler.volume(this.playerVolume);
        }
      },
      computed: {
        singleTracks() {
          return this.tracks.filter( t => t.album == "" || ! t.album )
        },
        currentTime() {
          return this.duration * ( this.percentage / 100 )
        },
        totalTime() {
          var minutes = 0
          var seconds = 0
          var hours = 0

          this.tracks.forEach( item => {
              time = item.duration.split(":")
              minutes = minutes + parseInt( time[0] )
              seconds = seconds + parseInt( time[1] )
          })

          if ( seconds > 60 ) {
            minutes = minutes + parseInt( seconds / 60 )
            seconds = seconds % 60
          }

          if ( minutes > 60 ) {
            hours = hours + parseInt( minutes / 60 )
            minutes = minutes % 60
          }

          if ( hours > 0 ) {
            return `${hours}:${minutes}:${seconds}`
          }
          minutes = this.pad( minutes )
          seconds = this.pad( seconds )
          return `${minutes}:${seconds}`
        }
      },
      methods: {
        trackLength( tracks ) {
          var minutes = 0
          var seconds = 0
          var hours = 0

          tracks.forEach( item => {
              time = item.duration.split(":")
              minutes = minutes + parseInt( time[0] )
              seconds = seconds + parseInt( time[1] )
          })

          if ( seconds > 60 ) {
            minutes = minutes + parseInt( seconds / 60 )
            seconds = seconds % 60
          }

          if ( minutes > 60 ) {
            hours = hours + parseInt( minutes / 60 )
            minutes = minutes % 60
          }

          if ( hours > 0 ) {
            return `${hours}:${minutes}:${seconds}`
          }
          minutes = this.pad( minutes )
          seconds = this.pad( seconds )
          return `${minutes}:${seconds}`
        },
        albumTracks( album ) {
            return this.tracks.filter( t => t.album == album.title ).sort( function (x, y) {
              return x.position - y.position
          } )
        },
        pad(num) {
          num = num.toString();
          while (num.length < 2) num = "0" + num;
          return num;
        },
        playAudio() {
          self = this
          Howler.unload()
          if ( this.selected_item.album == "" || ! this.selected_item.album ) {
            this.albums.forEach( a => a.position = "" )
          } else {
            this.selected_item_index = ""
          }
          this.sound = new Howl({
            src: [ `audio/${this.selected_item.audio}.webm`, `audio/${this.selected_item.audio}.mp3` ],
            onmute: function() { self.toggleMute() },
            onplay: function() { 
              self.togglePlay()
              requestAnimationFrame(self.step)
            },
            onpause: function() { self.togglePlay() },
            onstop: function() { self.togglePlay() },
            onend: function() { self.playNext() },
          })
          this.sound.once('load', function(){
            self.duration = self.sound.duration()
          });
          this.sound.play()
          this.playing = true
          this.loaded = true
          this.percentage = this.sound.seek()
        },
        toggleMute() {
          this.isMuted = this.sound.mute()
        },
        togglePlay() {
          this.playing = this.sound.playing()
          this.paused = ! this.sound.playing()
        },
        playNext() {
          if ( ! this.autoplay ) {
            return
          }
          if ( this.selected_item.album == "" || ! this.selected_item.album ) {
            found_track = false
            this.singleTracks.forEach( t => {
              if ( found_track ) {
                this.albums.forEach( a => a.position = "" )
                this.tracks.forEach( ( item, index ) => {
                  if ( item == t ) {
                    this.selected_item = this.tracks[index]
                    this.selected_item_index = index
                    this.playAudio()
                    return
                  }
                })
              }
              if ( t.title == this.selected_item.title ) {
                found_track = true
              }
            })
            if ( this.albums && this.albums.length > 0 ) {
              next_song = this.albumTracks( this.albums[0] )
              this.albums[0].position = 0
              this.selected_item = next_song[0]
              this.selected_item_index = ""
              this.playAudio()
            }
            return
          }

          position = this.selected_item.position
          next_item = position + 1
          album = this.albums.filter( a => a.title == this.selected_item.album )[0]
          album.position = position
          
          next_song = this.albumTracks( album ).filter( t => t.position == next_item )

          if ( next_song.length != 1 ) {
            return
          }
          this.selected_item = next_song[0]
          this.selected_item_index = ""
          this.playAudio()
        },
        step() {
          var seek = this.sound.seek() || 0
          this.percentage = seek / this.duration * 100
          if (this.sound.playing()) {
            setTimeout(function() {
              requestAnimationFrame(self.step)
              }, 100)
          }
        }
      },
    })
  </script>
</body>
</html>