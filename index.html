<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Austin Ginder's Music</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <style>
      [v-cloak] > * {
        display:none;
      }
    </style>
</head>
<body>
  <div id="app" v-cloak>
    <v-app>
      <v-main>
        <v-toolbar dark color="primary">
            <v-toolbar-title>Austin Ginder's Music</v-toolbar-title>
            <v-spacer></v-spacer>
            <v-tooltip bottom>
              <template v-slot:activator="{ on, attrs }">
                <v-btn href="https://austinginder.com" icon target="_blank" v-bind="attrs" v-on="on"><v-icon>mdi-home</v-icon></v-btn>
              </template>
              <span><v-icon small>mdi-open-in-new</v-icon> austinginder.com</span>
            </v-tooltip>
            <v-tooltip bottom>
              <template v-slot:activator="{ on, attrs }">
                <v-btn href="https://soundcloud.com/austinginder/" icon target="_blank" v-bind="attrs" v-on="on"><v-icon>mdi-soundcloud</v-icon></v-btn>
              </template>
              <span><v-icon small>mdi-open-in-new</v-icon> soundcloud.com/austinginder</span>
            </v-tooltip>
            <v-tooltip bottom>
              <template v-slot:activator="{ on, attrs }">
                <v-btn href="https://github.com/austinginder/music/" icon target="_blank" v-bind="attrs" v-on="on"><v-icon>mdi-github</v-icon></v-btn>
              </template>
              <span><v-icon small>mdi-open-in-new</v-icon> github.com/austinginder/music</span>
            </v-tooltip>
        </v-toolbar>
        <v-card flat class="text-center mt-4">
            <v-icon size="20" class="mb-1">mdi-folder-music-outline</v-icon> {{ items.length }} tracks <v-icon size="20" class="ml-4 mb-1">mdi-clock-outline</v-icon> {{ totalTime }} duration 
        </v-card>
        <v-container>
            <v-row>
              <v-col cols="12">
                <v-list class="elevation-2" max-width="800px" style="margin:auto;">
                  <v-list-item-group v-model="selected_item_index" color="primary">
                    <v-list-item
                      v-for="item in items"
                      :key="item.title"
                      target="_blank"
                      :href=`audio/${item.audio}.webm`
                      @click.prevent="selected_item = item; playAudio()"
                    >
                      <v-list-item-avatar>
                          <v-icon large>mdi-play-box</v-icon>
                      </v-list-item-avatar>
                      <v-list-item-content>
                        <v-list-item-title>
                            {{ item.title }}
                        </v-list-item-title>
                        <v-list-item-subtitle>
                          <v-icon size="18" class="mb-1">mdi-clock-outline</v-icon> {{ item.duration }} <v-icon size="18" class="ml-5">mdi-calendar-clock</v-icon> {{ item.date }}
                        </v-list-item-subtitle>
                      </v-list-item-content>
                    </v-list-item>
                    </v-list-item-group>
                </v-list>
              </v-col>
            </v-row>
        </v-container>
      </v-main>
      <v-footer fixed padless app>
        <v-card width="100%" color="grey lighten-4">
          <v-card-text style="max-width:400px;margin:auto" class="text-center pa-2">
              <v-btn icon class="ma-2" @click.native="sound.playing() ? sound.pause() : sound.play()" :disabled="!loaded">
                  <v-icon large v-if="!playing || paused">mdi-play-circle</v-icon>
                  <v-icon large v-else>mdi-pause-circle</v-icon>
              </v-btn>
              <v-btn icon class="ma-2" @click.native="sound.stop()" :disabled="!loaded">
                  <v-icon large>mdi-stop-circle</v-icon>
              </v-btn>
              <v-btn icon class="ma-2" @click.native="sound.mute( true )" :disabled="!loaded" v-if="! isMuted">
                  <v-icon large>mdi-volume-high</v-icon>
              </v-btn>
              <v-btn icon class="ma-2" @click.native="sound.mute( false )" :disabled="!loaded" v-else>
                <v-icon large>mdi-volume-off</v-icon>
              </v-btn>
              <v-btn icon class="ma-2" v-if="loaded" :href=`audio/${selected_item.audio}.mp3` target="_blank">
                  <v-icon large>mdi-download-circle</v-icon>
              </v-btn>
              <v-tooltip bottom>
                <template v-slot:activator="{ on, attrs }">
                  <v-btn icon class="ma-2" v-show="autoplay" @click="autoplay = false" v-bind="attrs" v-on="on">
                    <v-icon large>mdi-repeat</v-icon>
                  </v-btn>
                </template>
                <span>Repeat</span>
              </v-tooltip>
              <v-tooltip bottom>
                <template v-slot:activator="{ on, attrs }">
                  <v-btn icon class="ma-2" v-show="! autoplay"  @click="autoplay = true" v-bind="attrs" v-on="on">
                    <v-icon large>mdi-repeat-off</v-icon>
                  </v-btn>
                </template>
                <span>Repeat</span>
              </v-tooltip>
              
              
              <v-slider v-model="playerVolume" prepend-icon="mdi-volume-high" max="1" step="0.01" min="0" v-show="!playerVolume"></v-slider>
              <v-progress-linear hide-details stream v-model="percentage" height="20" @change="sound.seek( duration * ( percentage / 100 ) )" :disabled="!loaded">
                <span v-show="selected_item.title" class="white--text caption">Austin Ginder - {{ selected_item.title }}</span>
              </v-progress-linear>
              <p>{{ currentTime | formatTime }} / {{ duration | formatTime }}</p>
          </v-card-text>
      </v-card>
      </v-footer>
    </v-app>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"></script>
  <script>
    new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data: {
          items: [
              { date: "Dec 7th, 2021", author: "Austin Ginder", title: "Hello I5", duration: "2:29", audio: "2021-12-07 Hello I5" },
              { date: "Dec 4th, 2021", author: "Austin Ginder", title: "Hello T1", duration: "2:27", audio: "2021-12-04 Hello T1" },
              { date: "Dec 2nd, 2021", author: "Austin Ginder", title: "Hello M2", duration: "2:02", audio: "2021-12-02 Hello M2" },
              { date: "Nov 27th, 2021", author: "Austin Ginder", title: "Hello L4", duration: "2:23", audio: "2021-11-27 Hello L4" },
              { date: "Nov 26th, 2021", author: "Austin Ginder", title: "Hello A1", duration: "1:32", audio: "2021-11-26 Hello A1" },
              { date: "Oct 21st, 2021", author: "Austin Ginder", title: "Hello World", duration: "1:28", audio: "2021-10-21 Hello World" },
          ],
          selected_item: {},
          selected_item_index: null,
          duration: 0,
          isMuted: false,
          paused: false,
          playing: false,
          autoplay: true,
          playerVolume: 1,
          percentage: 0,
          sound: {},
          loaded: false,
      },
      filters: {
        formatTime: function ( value ) {
          var sec_num = parseInt(value, 10); // don't forget the second param
          var hours   = Math.floor(sec_num / 3600);
          var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
          var seconds = sec_num - (hours * 3600) - (minutes * 60);

          if (hours   < 10) {hours   = "0"+hours;}
          if (minutes < 10) {minutes = "0"+minutes;}
          if (seconds < 10) {seconds = "0"+seconds;}
          return minutes + ':' + seconds;
        },
      },
      watch: {
        playerVolume() {
          Howler.volume(this.playerVolume);
        }
      },
      computed: {
        currentTime() {
          return this.duration * ( this.percentage / 100 )
        },
        totalTime() {
          var minutes = 0
          var seconds = 0
          var hours = 0

          this.items.forEach( item => {
              time = item.duration.split(":")
              minutes = minutes + parseInt( time[0] )
              seconds = seconds + parseInt( time[1] )
          })

          if ( seconds > 60 ) {
            minutes = minutes + parseInt( seconds / 60 )
            seconds = seconds % 60
          }

          if ( minutes > 60 ) {
            hours = hours + parseInt( minutes / 60 )
            minutes = minutes % 60
          }

          if ( hours > 0 ) {
            return `${hours}:${minutes}:${seconds}`
          }
          minutes = this.pad( minutes )
          seconds = this.pad( seconds )
          return `${minutes}:${seconds}`
        }
      },
      methods: {
        pad(num) {
          num = num.toString();
          while (num.length < 2) num = "0" + num;
          return num;
        },
        playAudio() {
          self = this
          Howler.unload()
          this.sound = new Howl({
            src: [ `audio/${this.selected_item.audio}.webm`, `audio/${this.selected_item.audio}.mp3` ],
            onmute: function() { self.toggleMute() },
            onplay: function() { 
              self.togglePlay()
              requestAnimationFrame(self.step)
            },
            onpause: function() { self.togglePlay() },
            onstop: function() { self.togglePlay() },
            onend: function() { self.playNext() },
          })
          this.sound.once('load', function(){
            self.duration = self.sound.duration()
          });
          this.sound.play()
          this.playing = true
          this.loaded = true
          this.percentage = this.sound.seek()
        },
        toggleMute() {
          this.isMuted = this.sound.mute()
        },
        togglePlay() {
          this.playing = this.sound.playing()
          this.paused = ! this.sound.playing()
        },
        playNext() {
          if ( ! this.autoplay ) {
            return
          }
          this.items.forEach( ( item, index ) => {
            if ( item == this.selected_item ) { 
              next_item = index + 1
            }
          })
          if ( this.items.length <= next_item ) {
            return
          }
          this.selected_item = this.items[next_item]
          this.selected_item_index = next_item
          this.playAudio()
        },
        step() {
          var seek = this.sound.seek() || 0
          this.percentage = seek / this.duration * 100
          if (this.sound.playing()) {
            setTimeout(function() {
              requestAnimationFrame(self.step)
              }, 100)
          }
        }
      },
    })
  </script>
</body>
</html>